{% extends "stemp/base.html" %}

{% load staticfiles %}

{% block header %}
<script src="{% static 'highcharts.js' %}"></script>
{% endblock %}

{% block content %}

Ready: {{ready}}
Get: {{get}}

<ul class="tabs" data-tabs id="demand_tabs">
  <li class="tabs-title is-active"><a href="#questions">Benutzerdefiniert</a></li>
  <li class="tabs-title"><a href="#list">Aus Liste</a></li>
</ul>

<div class="tabs-content" data-tabs-content="demand_tabs">
  <div class="tabs-panel is-active" id="questions">
    <form method="post">
      {% csrf_token %}
      <table>
        {{specific_form}}
      </table>
      {% if new_form %}
        <input type="submit" value="Aktualisieren" name="questions">
      {% else %}
        <input type="submit" value="Weiter" name="questions">
      {% endif %}
    </form>
    {% if new_form %}
      <form id="household_form" method="post">
        {% csrf_token %}
        <table>
          {{new_form}}
        </table>
        <input type="hidden" value={{new_form.question_id}} name="question_id">
        <input type="submit" value="Weiter" name="new">
      </form>
    {% endif %}
  </div>
  <div class="tabs-panel" id="list">
    <form method="post">
      {% csrf_token %}
      <table>
        {{list_form}}
      </table>
      <input type="submit" value="Weiter" name="list">
    </form>
  </div>
</div>

{% endblock %}

{% block scripts %}
  {% if new_form %}
    <script src="{% static 'jquery.js' %}"></script>
    <script language="JavaScript">
      var changed = false;

      $("#household_form :input").change(function() {
        if (! changed) {
          changed = true;
          enable_saving_mode();
        }
      });

      function enable_saving_mode() {
        $("input[name=new]").attr("value", "Speichern & Weiter");
        $("input[name=new]").attr("name", "new_save");
        $("input[name=name]").prop("readonly", false);

        $.ajax(
          {
            url: "{% url 'stemp:household_name' %}",
            data: {
              'hh_name': $("input[name=name]").attr("value")
            },
            dataType: 'json',
            success: function (result) {
              $("input[name=name]").attr("value", result.next)
            }
          }
        );
      };
    </script>
  {% endif %}
{% endblock %}